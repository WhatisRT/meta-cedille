let PreParam := [[Product init$name] init$term].
let mkPreParam := <<prodPair init$name> init$term>.
let Param := [[Product Bool] PreParam]. -- potentially erased
let mkParam := <<prodPair Bool> PreParam>.

let paramErased := <<pr1 Bool> PreParam> : Π _ : Param Bool.
let paramName := λ p : Param [<<pr1 init$name> init$term> [<<pr2 Bool> PreParam> p]] : Π _ : Param init$name.
let paramType := λ p : Param [<<pr2 init$name> init$term> [<<pr2 Bool> PreParam> p]] : Π _ : Param init$term.

let init$params := [List Param].
let init$params$=lparen=_param_=rparen=_space__params_ := λ p : PreParam λ _ : init$space
  [<cons Param> [[mkParam false] p]].
let init$params$=lsquare=_param_=rsquare=_space__params_ := λ p : PreParam λ _ : init$space
  [<cons Param> [[mkParam true] p]].
let init$params$ := <nil Param>.

let init$param$_name__space_=colon=_space__term_ := λ n : init$name λ _ : init$space λ _ : init$space λ t : init$term
  [[mkPreParam n] t].

let paramToLambda := λ t : init$term λ p : Param
  [[[[[
    [<ifthenelse Π _ : init$name Π _ : init$term Π _ : init$term init$term> [paramErased p]]
      quote$Lambda]
      quote$lambda]
    [paramName p]] [paramType p]] t]
  : Π _ : init$term Π _ : Param init$term.

let foldWithLambdas := [<<foldl Param> init$term> paramToLambda] : Π _ : init$params Π _ : init$term init$term.

let paramToPi := λ t : init$term λ p : Param
  [[[[[
    [<ifthenelse Π _ : init$name Π _ : init$term Π _ : init$term init$term> [paramErased p]]
      quote$forall]
      quote$Pi]
    [paramName p]] [paramType p]] t]
  : Π _ : init$term Π _ : Param init$term.

let foldWithPi := [<<foldl Param> init$term> paramToPi] : Π _ : init$params Π _ : init$term init$term.

let init$stmt$b=minus=let_space__name__space__params_=colon=_space__term__space_=colon==equal=_space'__term_=dot= := λ _ : init$space λ n : init$name λ _ : init$space λ params : init$params λ _ : init$space λ type : init$term λ _ : init$space λ _ : init$space' λ term : init$term [[[quote$annotatedLet n] [[foldWithLambdas params] term]] [[foldWithPi params] type]].

seteval eval init stmt.